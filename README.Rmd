---
title: "mappeR"
output: rmarkdown::github_document
date: "2024-09-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
devtools::load_all()
```

This is an implementation of the [mapper](https://research.math.osu.edu/tgda/mapperPBG.pdf) algorithm by Singh, MÃ©moli, and Carlsson, and also the [ballmapper](https://arxiv.org/pdf/1901.07410.pdf) algorithm from Dlotko.

To install the latest version of this package from Github, run the following commands:

`install.packages("devtools")`

`library(devtools)`

`devtools::install_github("Uiowa-Applied-Topology/mappeR", upgrade=FALSE)`

`library("mappeR")`

If you're installing from Github, you might need to do some more stuff:

- **Windows:** install Rtools (http://cran.r-project.org/bin/windows/Rtools/)
- **OS X:** install Xcode (from the Mac App Store)
- **Linux:** run `apt-get install r-base-dev` (or similar).

## Examples

```{r hourglass data, include=FALSE}
require(rgl)
options(rgl.useNULL = TRUE)
require(webshot2)
num_points = 5000

hourglass.data = data.frame( x= sapply(1:num_points, function(x) sin(x)*10) + rnorm(num_points, 0, 0.1), y = sapply(1:num_points, function(x) cos(x)*cos(x)*sin(x)*10) + rnorm(num_points, 0, 0.1), z = sapply(1:num_points, function(x) 10*sin(x)*cos(x)*sin(x))+ rnorm(num_points, 0, 0.1))

hourglass.dist = dist(hourglass.data)

num_bins = 10
percent_overlap = 25
projx = hourglass.data$x
projy = hourglass.data$y
projz = hourglass.data$z
```

```{r plotting the curve,fig.show="hold", out.width="50%"}
plot3d(hourglass.data, pch=20, asp=1)
view3d(theta=-90, phi=30)
rglwidget()
plot3d(hourglass.data, pch=20, asp=1)
view3d(theta=-60, phi=30)
rglwidget()
plot3d(hourglass.data, pch=20, asp=1)
view3d(theta=-30, phi=30)
rglwidget()
plot3d(hourglass.data, pch=20, asp=1)
view3d(theta=0, phi=30)
rglwidget()
plot3d(hourglass.data, pch=20, asp=1)
view3d(theta=30, phi=30)
rglwidget()
plot3d(hourglass.data, pch=20, asp=1)
view3d(theta=60, phi=30)
rglwidget()
plot3d(hourglass.data, pch=20, asp=1)
view3d(theta=90, phi=30)
rglwidget()

plot(hourglass.data)
```

```{r mapping the mapper, fig.show="hold", out.width="50%"}

colfunc <- colorRampPalette(c("red", "gold", "blue"))
bin_colors = colfunc(num_bins)
mapperobjectx = get_1D_mapper_data(hourglass.data, projx, hourglass.dist, num_bins, percent_overlap, "single")
mapperobjecty = get_1D_mapper_data(hourglass.data, projy, hourglass.dist, num_bins, percent_overlap, "single")
mapperobjectz = get_1D_mapper_data(hourglass.data, projz, hourglass.dist, num_bins, percent_overlap, "single")
coverx = mappeR::create_width_balanced_cover(min(projx), max(projx), num_bins, percent_overlap)
covery = mappeR::create_width_balanced_cover(min(projy), max(projy), num_bins, percent_overlap)
coverz = mappeR::create_width_balanced_cover(min(projz), max(projz), num_bins, percent_overlap)

imappergraphx = imapper(mapperobjectx)
plot(imappergraphx, xlim=c(0, 2))
legend("right", title="x-coordinate", apply(coverx, 1, function(x) paste("[", round(x[1], 3), ", ", round(x[2], 3), "]")), fill=bin_colors, horiz=FALSE)

imappergraphy = imapper(mapperobjecty)
plot(imappergraphy, xlim=c(0, 2))
legend("right", title="y-coordinate", apply(covery, 1, function(x) paste("[", round(x[1], 3), ", ", round(x[2], 3), "]")), fill=bin_colors, horiz=FALSE)

imappergraphz = imapper(mapperobjectz)
plot(imappergraphz, xlim=c(0, 2))
legend("right", title="z-coordinate", apply(coverz, 1, function(x) paste("[", round(x[1], 3), ", ", round(x[2], 3), "]")), fill=bin_colors, horiz=FALSE)
```
